### Предыдущая страница: [Шаблоны](/docs/ru/templates.md)

# Настройка конфигурации

Стандартная настройка регистрации модуля _geomap_ в конфигурации приложения включает в себя следующие разделы:

- [x] [Настройка области размещения стандартных Яндекс элементов и лоадера `"ymapControls"`](/docs/ru/additional_settings.md#настройка-области-размещения-стандартных-яндекс-элементов-и-лоадера)
- [x] [Настройка плавающих панелей `"panels"`](/docs/ru/additional_settings.md#настройка-плавающих-панелей)
- [x] [Настройка панели для фильтров `"panels"`](/docs/ru/additional_settings.md#настройка-панели-для-фильтров)
- [x] [Настройка инструмента выделения произвольной области на карте `"stroke"`](/docs/ru/additional_settings.md#настройка-инструмента-выделения-произвольной-области-на-карте)
- [x] [Отображение объекта по шаблону `"templates"`](/docs/ru/additional_settings.md#отображение-объекта-по-шаблону)
- [x] [Интеграция внешних значков `"statics"`](/docs/ru/additional_settings.md#интеграция-внешних-значков)
- [x] [Настройка региональных контуров `"regions"`](/docs/ru/additional_settings.md#настройка-региональных-контуров)
- [x] [Настройка для освобождения места на карте при поиске `"search"`](/docs/ru/additional_settings.md#настройка-для-освобождения-места-на-карте-при-поиске)
- [x] [Настройка расположения пунктов меню фильтра `"search"`](/docs/ru/additional_settings.md#настройка-расположения-пунктов-меню-фильтра)
- [x] [Настройка выделения результатов поиска на карте `"search"`](/docs/ru/additional_settings.md#настройка-выделения-результатов-поиска-на-карте)
- [x] [Настройка уникальной иконки для страницы модуля `"logo"`](/docs/ru/additional_settings.md#настройка-уникальной-иконки-для-страницы-модуля)
- [x] [Настройка вывода легенды карты `"legend"`](/docs/ru/additional_settings.md#настройка-вывода-легенды-карты)

Структура которых строится следующим образом:
```json
"geomap": {
      "globals": {
        "ymapControls": {...},
        "panels": {...},
        "hidePageHead": false,
        "hidePageSidebar": true,
        "stroke": {...},
        "namespaces": {...},
        "templates": [...],
        "statics": {...},
        "start": [...],
        "zoom": 10,
        "regions": {...},
        "defaultNav": {...},
        "search": {...},
        "formFilter": {...},
        "logo": "...",
        "di": {...}
      },
      "import": {...}
    }
```

_Далее подробно по каждому разделу:_

## Настройка области размещения стандартных Яндекс элементов и лоадера

Стандартные элементы управления карты настраиваются через параметр `ymapControls`. Если элемент отсутствует в настройках или равен *null*, то он не размещается на карте.

Описание элементов можно найти [здесь](https://tech.yandex.ru/maps/doc/jsapi/2.1/dg/concepts/controls-docpage/#standard)

Вместе с ними настраивается лоадер данных (`loader`).
Поскольку loader не стандартный элемент, то к нему, помимо *position*, 
могут напрямую применяться стили (*cssStyle*) и классы (*cssClass*),
если нужно.

*Пример:*

```javascript
"ymapControls": {
  "loader" : {
    "position" : {
      "left" : 15,
      "top": 90
    }
  }   
}
```

## Настройка плавающих панелей

```javascript
"hidePageSidebar": true,
"panels": {
  "rightInfo" : { //отвечает за правую выдвигающую панель. Если настройка не задана, то панель будет скрыта с карты.
    "type" : "rightInfo"
  },
  "navFloat" : { //navFloat - плавающая панель в пределах карты.
    "type" : "float",
    "cssStyle" : "left:0; top:36px; width: 320px"
  }
}
```
Варианты позиционирования с помощью свойства cssStyle:
* левый верхний - "left:0; top:0;"
* левый нижний - "left:0; bottom:0;"
* правый верхний - "right:0; top:0;"
* левый нижний (с учетом места под легенду) - "left:0; bottom:36px;"

Настройка секций выполняется в разделе навигации геомодуля. [Подробнее](/docs/ru/navigation.md)

## Настройка панели для фильтров

Фильтры располагаются на плавающей панели, параметры которой задаются по примеру:
```javascript
"panels":[
  "filterFloat": {
    "type" : "float",
    "title": "Фильтры",
    "cssClass": "map-filter-float",
    "cssStyle" : "left:400px; bottom:45px; width: 280px; max-height:calc(100% - 163px);"
  }
],
"stroke": {
  "panel": {
    "name": "filterFloat"
  }
},
"search": {
  "panel": {
    "name": "filterFloat"
  }
},
"formFilter": {
  "panel": {
    "name": "filterFloat"
  }
},
"regions": {
  "panel": {
    "name": "filterFloat"
  }    
}        
```

Для возможности **сворачивания панели** к *css-классам* добавить `"collapsible"`. Изначально панель свернута, чтобы развернуть добавить класс `"open"`.

```javascript
...
 "panels": {
    "filterFloat": {
        "cssClass" : "map-filter-float collapsible open",
        ...
    }
 } 
 ...
```
## Настройка инструмента выделения произвольной области на карте

Настройки фильтра **"Обводка"** задается по следующему примеру:

```javascript
"stroke": {
  "path": {
    "strokeColor": '#f0000',
    "strokeWidth": 6,
    "opacity": 0.8
  },
  "polygon": {
    "fillColor": '#00f0ff',
    "fillOpacity": 0.1,
    "strokeColor": '#0000ff',
    "strokeOpacity": 0.9,
    "strokeWidth": 3
  }
}
```
Выше указаны значения параметров по умолчанию, можно задавать только выборочные значения:
```javascript
"stroke": {
  "path": {
    "strokeColor": "#00ff00"
  }
}
``` 
## Отображение объекта по шаблону

Задаем в deploy.json приложения путь до папки с шаблонами.
Если шаблон использует статичные ресурсы, то подключаем и их.

```javascript
"templates": [
  "applications/namespaceApp/templates"
],
"statics": {
  "geoicons": "applications/namespaceApp/icons"
}
```
Размещаем файлы шаблонов (ejs).
При рендере ejs получает найденный объект item (класса Item)

_Примеры:_

1. `/applications/ns/templates/geo/balloon/test.ejs`:
```
Balloon content
<h4><%= item.id %></h4>
<p><%= item.toString() %></p>
```

2. `/applications/namespaceApp/templates/geo/frame/test.ejs`:
```
Frame content
<h4><%= item.id %></h4>
<p><%= item.toString() %></p>
```

Их идентификаторами для клиента будет относительный путь:
```
  geo/balloon/test
  geo/frame/test
```

В случае отображения шаблона в выплывающем справа окне фрейма,
используется ссылка, которую указываем на кнопке в макете карточке гео-объекта:
```
/geomap/render/ns/className/{{ properties.itemId }}?template=geo/frame/test
```

В случае отображения шаблона в карточке гео-объекта, необходима асинхронная загрузка после ее отображения. Для этого формируем загрузочный макет карточки в настройках геослоя и указываем ссылку на нужный шаблон:

```javascript
"data": [{
  "params" :
  {
     "balloonContentLayoutClass": "<div class='map-ajax-balloon' data-url='/geomap/render/ns/className/{{ properties.itemId }}?template=geo/balloon/test'><i class='fa fa-refresh fa-spin'></i></div>"
  }
]
```
Учитывайте, что рендер балуна идет в том же DOM, что и карта. В отличие от рендера в боковом фрейме.

## Интеграция внешних значков

В нужном приложении (application) надо настроить директорию, содержащую статичные файлы, которые будет отдавать сервер (в нашем случае икнонки). Для этого объявляем их следующим образом:

```javascript
"statics":[
  {
    "path":"applications/namespaceApp/icons", 
    "name":"geoicons"
  }
]
```
В массиве _statics_ задаются объекты: 
* **path** - путь до директории относительно директории `platform/`
* **name** - название маппинга который будет использоваться приложением.

Вторым шагом необходимо указать иконки для геослоев. [Подробнее]()


## Настройка региональных контуров

Для использования контуров региона необходимо определить код региона через https://www.openstreetmap.org. 
Полученный код задаем для свойства `"osmIds"`.

*Пример настройки регионального контура:*
```javascript
"regions": 
  {
    "enabled" : true, //отображать контур при открытии карты
    "osmIds" : [ 
      "151223"
    ]
  }
```

## Настройка для освобождения места на карте при поиске

С помощью настройки освобождается место на карте за счет скрытия боковой панели, при вводе поискового запроса. 
Подключение для фильтра поиска:

```javascript
    "search": {
          "enabled": true,
          "timeout": 1000,
          "panel": {
            "name": "navFloat"
          },
          "events" : {
            "found" : [
              {
                "handler" : "hidePanel",
                "panel" : "rightInfo"
              }
            ]
          }
        }
```
Для фильтра поиска определяется _handler_ `hidePanel`, который подключается на событие фильтра `found`.

## Настройка расположения пунктов меню фильтра

Порядок задается для нужного фильтра свойством `"orderNumber"`
```javascript
"search": {
  "panel": {
    "name": "filterFloat",
    "orderNumber": 10
  },
  "enabled" : true,
  "timeout" : 2000
}
```
Порядок влияет на размещение фильтра только в указанной панели.
Если у фильтра указан порядок, то фильтр всегда будет выше тех, где порядок не задан.

## Настройка выделения результатов поиска на карте

Параметры слоя результатов поиска, которые будут применены **ко всем слоям**:
```javascript
{
"search": {
  "highlightFoundObjects" : true,
  "layer": {
	  "options": {
	    "geoObjectPreset" : "islands#blueDotIconWithCaption",
      "clusterPreset" : "islands#invertedBlueClusterIcons"
	  }
	}
}
```

Для настройки отображения результатов поиска **для конкретного слоя**, параметры указываются в мете геослоя. [Подробнее](/docs/ru/geo-layer.md#настройка-выделения-результатов-поиска-на-карте)

## Настройка уникальной иконки для страницы модуля
```javascript
"logo": "common-static/logo.png"
```

## Настройка вывода легенды карты

Легенда карты активируется через настройки в deploy.json проекта. Если их нет, то легенда отсутствует.
Свойство `collapsed` отвечает за начальное состояние легенды - открыта или свернута:

```javascript
"legend": {
  "collapsed": false
}
```
Создание иконок для легенды берется только из настроек слоя описанного в гео-мете. Так как геоданные могут быть в формате *FeatureCollection*, который может содержать любые объекты, свойства и опции (в разном сочетании).

По умолчанию включена кластеризацию для всех данных. Можно отключить ее для конкретного гео-слоя. Это необходимо если во *FeatureCollection* используются объекты кроме типа *Point*:
```javascript
{
  "data":[{
    "options": {
      "clusterize": false
   }
  }]
}
```

_Кастомизации иконок созданных через `geobuilder`_

Через настройки геослоя нельзя поменять *preset* иконки, потому что данные приходят в формате *FeatureCollection*, который уже содержит его для каждого объекта и это перекрывает общие свойства задаваемые в слое. Можно лишь подставить те которые не заданы (как c *glyphicon*).

Так что для согласованного изменения цвета (вида) иконок на карте и легенде, нужно менять их и в `geobuilder` и в настройке гео-слоя.

### Следующая страница: [Пример конфигационного файла](/docs/ru/example.md)






















